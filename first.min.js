function Board(){this.points=0,this.control_sum=[[],[]],this.must_clean=[[],[]]}function Figur(o,t){this.class_name=t,this.board=o,this.block_size=parseInt(OPTIONS.FullBlockSize/1.3),this.number,this.kind=-1,this.blocks=[]}function getRandomColor(){var o="0123456789ABCDEF".split(""),t="#";return t=o[Math.floor(16*Math.random())]}var OPTIONS={BoardClassName:"board",BlockClassName:"block",BoardSize:10,BlockSize:parseInt($(document).height()/15),FullBlockSize:parseInt($(document).height()/15+4)};OPTIONS.FullBoardSize=OPTIONS.FullBlockSize*OPTIONS.BoardSize,parseInt(($(document).width()-OPTIONS.FullBoardSize)/2)>250?OPTIONS.Offset=parseInt(($(document).width()-OPTIONS.FullBoardSize)/2):OPTIONS.Offset=0,Board.prototype.restart_board=function(){this.control_sum=[[],[]],this.must_clean=[[],[]],this.points=0;for(var o=OPTIONS.BoardSize-1;o>=0;o--){for(var t=OPTIONS.BoardSize-1;t>=0;t--)$("."+OPTIONS.BoardClassName+">#"+o+"_"+t).animate({backgroundColor:"#ffffff"},600);this.control_sum[0][o]=0,this.control_sum[1][o]=0}},Board.prototype.draw=function(){console.log($("."+OPTIONS.BlockClassName).outerHeight());for(var o=OPTIONS.BoardSize-1;o>=0;o--){for(var t=OPTIONS.BoardSize-1;t>=0;t--){var s='style="left:'+(OPTIONS.Offset+OPTIONS.FullBlockSize*o)+"px;top:"+OPTIONS.FullBlockSize*t+'px;"';$("."+OPTIONS.BoardClassName).append('<div class="'+OPTIONS.BlockClassName+'" id="'+o+"_"+t+'" '+s+"></div>")}this.control_sum[0][o]=0,this.control_sum[1][o]=0}$("."+OPTIONS.BlockClassName).css({width:OPTIONS.BlockSize,height:OPTIONS.BlockSize})},Board.prototype.can_input_figur=function(o,t,s){for(var i in o.blocks){var r=t+o.blocks[i][0],e=s+o.blocks[i][1],a=$("#"+r+"_"+e),n=a.css("background-color");if(0>r||r>=OPTIONS.BoardSize||0>r||r>=OPTIONS.BoardSize||"rgb(255, 255, 255)"!=n||void 0==a)return!1}return!0},Board.prototype.can_input_any_figurs=function(o){for(var t in o)for(var s=OPTIONS.BoardSize;s>=-2;s--)for(var i=OPTIONS.BoardSize;i>=-2;i--)if(this.can_input_figur(o[t],s,i))return!0;return!1},Board.prototype.input_figur=function(o,t,s){for(var i in o.blocks){var r=t+o.blocks[i][0],e=s+o.blocks[i][1];$("#"+r+"_"+e).css("backgroundColor",o.background_color),this.control_sum[0][r]++,this.control_sum[1][e]++,this.points++}},Board.prototype.is_need_clean=function(){var o=!1;for(var t in this.must_clean)for(var s=OPTIONS.BoardSize-1;s>=0;s--)this.control_sum[t][s]>=OPTIONS.BoardSize&&(this.must_clean[t][s]=!0,o=!0);return o},Board.prototype.clean=function(){for(var o in this.must_clean)for(var t in this.must_clean[o])if(this.must_clean[o][t]){for(var s=OPTIONS.BoardSize-1;s>=0;s--)0==o&&($("#"+t+"_"+s).animate({backgroundColor:"#BDBDBD"},400),$("#"+t+"_"+s).animate({backgroundColor:"#ffffff"},400)),1==o&&($("#"+s+"_"+t).animate({backgroundColor:"#BDBDBD"},400),$("#"+s+"_"+t).animate({backgroundColor:"#ffffff"},400)),this.points++,this.control_sum[1-o][s]>0&&this.control_sum[1-o][s]--;this.must_clean[o][t]=!1,this.control_sum[o][t]=0}console.log(this.control_sum)},Board.prototype.status=function(){console.log("must_clean.x="+this.must_clean[0].join(" ")),console.log("must_clean.y="+this.must_clean[1].join(" ")),console.log("control_sum.x="+this.control_sum[0].join(" ")),console.log("control_sum.x="+this.control_sum[1].join(" "))},Figur.prototype.figurs_count=3,Figur.prototype.figurs=[],Figur.prototype.blocks_colors=["#F44336","#E91E63","#D500F9","#2196F3","#5C6BC0","#00BCD4","#009688","#18FFFF","#43A047","#00E676","#8BC34A","#D4E157","#FFEB3B","#FFC107","#FF5722","#FB8C00"],Figur.prototype.blocks_combimation=[[[2,1],[2,2]],[[2,1],[2,2],[2,3]],[[2,0],[2,1],[2,2],[2,3]],[[2,0],[2,1],[2,2],[2,3],[2,4]],[[1,2],[2,2]],[[1,2],[2,2],[3,2]],[[0,2],[1,2],[2,2],[3,2]],[[0,2],[1,2],[2,2],[3,2],[4,2]],[[2,2]],[[2,2],[2,3],[3,2],[3,3]],[[1,1],[1,2],[1,3],[2,1],[2,2],[2,3],[3,1],[3,2],[3,3]],[[2,1],[2,2],[3,2]],[[2,1],[3,1],[3,2]],[[3,1],[2,1],[2,2]],[[3,1],[3,2],[2,2]],[[1,1],[1,2],[1,3],[2,3],[3,3]],[[1,1],[2,1],[3,1],[3,2],[3,3]],[[3,1],[2,1],[1,1],[1,2],[1,3]],[[3,1],[3,2],[3,3],[2,3],[1,3]]],Figur.prototype.draw=function(o){this.figurs[o]=this,this.number=o,this.background_color=this.blocks_colors[Math.floor(Math.random()*this.blocks_colors.length)],this.kind=Math.floor(Math.random()*this.blocks_combimation.length),this.blocks=this.blocks_combimation[this.kind];var t=OPTIONS.Offset+OPTIONS.FullBoardSize*(1/3*this.number),s=this.block_size;$(".figurs").append("<div class="+this.class_name+"></div>");for(var i in this.blocks){var r='style="left:'+parseInt(t+this.block_size*this.blocks[i][0])+"px;top:"+parseInt(s+OPTIONS.FullBoardSize+this.block_size*this.blocks[i][1])+'px;"';$("."+this.class_name).append('<div class="block_move" id="'+this.blocks[i][0]+"_"+this.blocks[i][1]+"_"+this.number+'" '+r+"></div>")}$("."+this.class_name+" > .block_move").multiDraggable({group:$("."+this.class_name+" > .block_move"),dragNative:function(){}}),$("."+this.class_name+" > .block_move").css({width:this.block_size,height:this.block_size}),$("."+this.class_name+" > .block_move").css("background-color",this.background_color)},Figur.prototype.upset=function(){var o=OPTIONS.Offset+OPTIONS.FullBoardSize*(1/3*this.number),t=this.block_size;for(var s in this.blocks)$("#"+this.blocks[s][0]+"_"+this.blocks[s][1]+"_"+this.number).css({left:parseInt(o+this.board.block_size*this.blocks[s][0]),top:parseInt(t+OPTIONS.FullBoardSize+this.board.block_size*this.blocks[s][1])});$("."+this.class_name+" > .block_move").css({width:this.board.block_size,height:this.board.block_size})},Figur.prototype.downset=function(){var o=OPTIONS.Offset+OPTIONS.FullBoardSize*(1/3*this.number),t=this.block_size;for(var s in this.blocks)$("#"+this.blocks[s][0]+"_"+this.blocks[s][1]+"_"+this.number).css({left:parseInt(o+this.block_size*this.blocks[s][0]),top:parseInt(t+OPTIONS.FullBoardSize+this.block_size*this.blocks[s][1])});$("."+this.class_name+" > .block_move").css({width:this.block_size,height:this.block_size})},Figur.prototype.is_need_generate=function(){for(var o in Figur.prototype.figurs)if(Figur.prototype.figurs[o])return!1;return!0},Figur.prototype.generate=function(o){for(var t=Figur.prototype.figurs_count-1;t>=0;t--)figur=new Figur(o,"figur"+t),figur.draw(t)},Figur.prototype.erase=function(){$("."+this.class_name).remove();var o=this.number;console.log("erase"),delete Figur.prototype.figurs[o]},$(document).ready(function(){function o(){$("#overlay").fadeIn(400,function(){var o;try{o=localStorage.getItem("1010-record")}catch(t){o=0}$("#best_result_points").text(o),$("#result_in_game").css("display","block").animate({opacity:1,top:"50%"},200),console.log(o),console.log(1),o<parseInt($("#result_points").text())&&(localStorage.setItem("1010-record",parseInt($("#result_points").text())),console.log(1))})}function t(){$("#points>span , #result_points").text("0"),s.restart_board();for(var o in Figur.prototype.figurs)var t=Figur.prototype.figurs[o].erase();Figur.prototype.is_need_generate()&&Figur.prototype.generate(s)}var s=new Board;s.draw(),Figur.prototype.generate(s),$("#points").css({left:OPTIONS.FullBoardSize+OPTIONS.Offset+OPTIONS.FullBlockSize,top:OPTIONS.FullBlockSize}),$("#restart").css({left:OPTIONS.FullBoardSize+OPTIONS.Offset+OPTIONS.FullBlockSize,top:3*OPTIONS.FullBlockSize}),$(function(){$("."+OPTIONS.BlockClassName).droppable({drop:function(t,i){var r=Figur.prototype.figurs[t.target.id.split("_")[2]];y=parseInt(this.id.split("_")[1])-parseInt(t.target.id.split("_")[1]),x=parseInt(this.id.split("_")[0])-parseInt(t.target.id.split("_")[0]),s.can_input_figur(r,x,y)&&(s.input_figur(r,x,y),s.status(),s.is_need_clean()&&(s.clean(),s.status()),r.erase(),Figur.prototype.is_need_generate()&&Figur.prototype.generate(s)),$("#points > span , #result_points").text(s.points),setTimeout(function(){s.can_input_any_figurs(Figur.prototype.figurs)||o()},2e3)}})}),$("#overlay , .button_block").click(function(){$("#result_in_game").animate({opacity:0,top:"45%"},200,function(){$(this).css("display","none"),$("#overlay").fadeOut(400)}),t()}),$("#restart").click(function(){o()})});